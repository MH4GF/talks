---
layout: cover
class: text-center
highlighter: shiki
mdc: true
lineNumbers: false
drawings:
  persist: false
transition: fade-out
title: Valibot Schema Driven UI - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ï¼
colorSchema: dark
theme: default
defaults:
  layout: custom-default
fonts:
  sans: "Lexend Exa, IBM Plex Sans, Noto Sans JP"
---

# Valibot Schema Driven UI<br>ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ Web ã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ï¼

TSKaigi 2025 - 2025/05/24 @MH4GF

---

# å®®åŸåºƒéš† / @MH4GF

<div flex="~ gap-1" items-center justify-center class="h-[70%]">
<div>

- <div class="flex gap-1 absolute"><a class="inline-flex gap-1" href="https://route06.co.jp/"><img class="w-6 h-6" src="https://avatars.githubusercontent.com/u/62282963?v=4" />ROUTE06, inc.</a></div>
- å¥½ããªcompiler optionã¯ `erasableSyntaxOnly`
- <div class="flex gap-1 absolute"><a class="inline-flex gap-1" href="https://liambx.com/"><img class="w-6 h-6" src="https://avatars.githubusercontent.com/u/187765721?v=4" />Liam ERD</a> PM å…¼ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰</div>
- [mh4gf.dev](https://mh4gf.dev/) / [X](https://x.com/MH4GF) / [GitHub](https://github.com/MH4GF)

</div>
<img src="https://avatars.githubusercontent.com/u/31152321?v=4" class="rounded-full w-50 h-50 mx-auto">
</div>

---
layout: image
image: /liam-erd.gif
---


---

# ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã¨ã¯

<v-clicks>

- ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®çŸ¥è­˜ãŒãªãã¦ã‚‚è¦–è¦šçš„ã«Webã‚µã‚¤ãƒˆã‚’æ§‹ç¯‰ã§ãã‚‹ãƒ„ãƒ¼ãƒ«
- ä»£è¡¨ä¾‹: Bubbleã€Webflowã€STUDIO ãªã©
- ã‚ˆãã‚ã‚‹æ©Ÿèƒ½
  - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ãƒ‘ãƒ¼ãƒ„ã‚’é¸ã³ UI ã‚’æ§‹ç¯‰
  - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ã§ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè‰²ãƒ»ã‚µã‚¤ã‚ºãƒ»é…ç½®ï¼‰ã‚’ç›´æ„Ÿçš„ã«èª¿æ•´
  - ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»å…¬é–‹ãŒå¯èƒ½

</v-clicks>

<!--
ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã¯ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã—ã§ã‚¢ãƒ—ãƒªã‚’ä½œã‚Œã‚‹ç”»æœŸçš„ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä¾‹ãˆã°Webflowãªã‚‰ã€æ™®æ®µHTMLã‚„CSSã‚’æ›¸ã„ãŸã“ã¨ãŒãªã„æ–¹ã§ã‚‚ç¾ã—ã„Webã‚µã‚¤ãƒˆãŒä½œã‚Œã¾ã™ã€‚

ã‚ˆãã‚ã‚‹æ©Ÿèƒ½ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã¾ãšåŸºæœ¬ã¨ãªã‚‹ã®ãŒãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã®UIã§ã™ã€‚ãƒœã‚¿ãƒ³ã‚„ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ¬„ãªã©ã®éƒ¨å“ã‚’ãƒã‚¦ã‚¹æ“ä½œã ã‘ã§é…ç½®ã§ãã‚‹ãŸã‚ã€HTMLã‚„CSSã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

æ¬¡ã«ã€é…ç½®ã—ãŸè¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ã‚‚è¦–è¦šçš„ã«è¡Œãˆã¾ã™ã€‚è‰²ã‚„ã‚µã‚¤ã‚ºã€é…ç½®ãªã©ã‚’ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚„ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã§ç›´æ„Ÿçš„ã«è¨­å®šã§ãã€CSSãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®çŸ¥è­˜ãŒãªãã¦ã‚‚ç¾ã—ã„ãƒ‡ã‚¶ã‚¤ãƒ³ãŒå¯èƒ½ã§ã™ã€‚

ãã—ã¦å®Œæˆã—ãŸã‚‰ã€è¤‡é›‘ãªãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šãªã—ã«ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å…¬é–‹ã§ãã‚‹ã®ã‚‚å¤§ããªç‰¹å¾´ã§ã™ã€‚
-->

---

# ã©ã†ã‚„ã£ã¦å®Ÿç¾ã•ã‚Œã¦ã„ã‚‹ï¼Ÿ

<v-clicks>

- UI ãƒ‘ãƒ¼ãƒ„ã®ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ãŒã€ã©ã®ã‚ˆã†ã« HTML ã‚„ CSS ã«å¤‰æ›ã•ã‚Œã‚‹ã®ã‹ï¼Ÿ
- ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ã§ã®å¤‰æ›´ã‚’ã€ã©ã†ã‚„ã£ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«åæ˜ ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ
- å¤šæ§˜ãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®çµ„ã¿åˆã‚ã›ã‚’ã€ã©ã†åŠ¹ç‡çš„ã«ç®¡ç†ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ

</v-clicks>

<!--
ã“ã‚Œã‹ã‚‰ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã®æŠ€è¡“çš„ãªå´é¢ã«ã¤ã„ã¦è€ƒãˆã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ã¾ãšã€ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ“ä½œã‚’ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹ä»•çµ„ã¿ã¯ã©ã†ãªã£ã¦ã„ã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ
è¦–è¦šçš„ãªæ“ä½œãŒã©ã®ã‚ˆã†ã«HTMLã‚„CSSã«å¤‰ã‚ã‚‹ã®ã‹ã€è€ƒãˆãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

æ¬¡ã«ã€ã‚¨ãƒ‡ã‚£ã‚¿ã§è‰²ã‚„ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ãŸã¨ãã€ãã®å¤‰æ›´ãŒã™ãã«åæ˜ ã•ã‚Œã‚‹ä»•çµ„ã¿ã¯ï¼Ÿ
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®æ›´æ–°ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€ä½•ãŒå¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ãã—ã¦ã€å¤šæ§˜ãªãƒ‡ã‚¶ã‚¤ãƒ³ã®çµ„ã¿åˆã‚ã›ã‚’ã©ã†ç®¡ç†ã—ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ï¼Ÿ
ç„¡é™ã¨ã‚‚è¨€ãˆã‚‹çµ„ã¿åˆã‚ã›ã‚’åŠ¹ç‡çš„ã«æ‰±ã†ãŸã‚ã®å·¥å¤«ã¨ã¯ï¼Ÿ

ã“ã†ã—ãŸç–‘å•ã«å¯¾ã™ã‚‹è§£æ±ºç­–ãŒã€å®Ÿã¯Webé–‹ç™ºå…¨èˆ¬ã§ã‚‚å¿œç”¨ã§ãã‚‹ãƒ’ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚
-->

---

# æœ¬ç™ºè¡¨ã®æ¦‚è¦ã¨ã‚´ãƒ¼ãƒ«

<v-clicks>

- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã® UI æ§‹ç¯‰éƒ¨åˆ†ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç´¹ä»‹
  - APIã¨ã®é€£æºã‚„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãªã©ã¯è©±ã—ã¾ã›ã‚“
- **Valibot** ã¨ **TypeScript** ã‚’æ´»ç”¨ã—ãŸå‹å®‰å…¨ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- ã‚ãã¾ã§ä¸€ä¾‹ã§ã€å…¨ã¦ã®ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ“ãƒ«ãƒ€ãƒ¼ãŒã“ã®å®Ÿè£…ã¨ã„ã†ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“

ã‚´ãƒ¼ãƒ«: **å‹•çš„ UI æ§‹ç¯‰æ©Ÿèƒ½ã®å‹å®‰å…¨ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç†è§£ã—ã€æ—¥ã€…ã®é–‹ç™ºã«æ´»ã‹ã›ã‚‹ã‚ˆã†ã«ãªã‚‹**

</v-clicks>

<!--
ä»Šæ—¥ã®ç™ºè¡¨ã§ã¯ã€ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã®UIæ§‹ç¯‰æ©Ÿèƒ½ã«ç„¦ç‚¹ã‚’å½“ã¦ã€ãã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ç‰¹ã«ã€Valibotã¨ã„ã†TypeScriptå‘ã‘ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸå‹å®‰å…¨ãªå®Ÿè£…æ–¹æ³•ã«æ³¨ç›®ã—ã¾ã™ã€‚ã“ã‚Œã¯å˜ã«ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ“ãƒ«ãƒ€ãƒ¼ã ã‘ã§ãªãã€å‹•çš„ãªUIã‚’æ‰±ã†ã‚ã‚‰ã‚†ã‚‹ã‚±ãƒ¼ã‚¹ã§å¿œç”¨ã§ãã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã«ã‚ˆã£ã¦è¡¨ç¤ºå†…å®¹ãŒå¤‰ã‚ã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€è¨­å®šã«å¿œã˜ã¦å½¢ãŒå¤‰ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ¬ãƒãƒ¼ãƒˆç”»é¢ãªã©ã€çš†ã•ã‚“ã®æ—¥å¸¸é–‹ç™ºã§ã‚‚ã€Œå‹•çš„ã«å¤‰ã‚ã‚‹UIã€ã¯é »ç¹ã«ç™»å ´ã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ä»Šæ—¥ãŠè©±ã—ã™ã‚‹å‹å®‰å…¨ãªã‚¹ã‚­ãƒ¼ãƒé§†å‹•ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å­¦ã¶ã“ã¨ã§ã€ãã†ã—ãŸå‹•çš„UIã‚’æŸ”è»Ÿã‹ã¤å®‰å…¨ã«å®Ÿè£…ã™ã‚‹ãƒ’ãƒ³ãƒˆã‚’æŒã¡å¸°ã£ã¦ã„ãŸã ã‘ã‚‹ã¨æ€ã„ã¾ã™ã€‚

å›³ã«ç¤ºã™ã‚ˆã†ã«ã€ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã«ã¯æ§˜ã€…ãªæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯èµ¤è‰²ã§ç¤ºã—ãŸUIæ§‹ç¯‰éƒ¨åˆ†ã‚’æ·±æ˜ã‚Šã—ã¦ã„ãã¾ã™ã€‚
-->

---

# ã‚¢ã‚¸ã‚§ãƒ³ãƒ€


1. **Valibot Schema Driven UI ã®åŸºæœ¬æ¦‚å¿µ**
2. **ãƒ‡ãƒ¢**
3. **ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**
4. **å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**
5. **æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³**
6. **ã¾ã¨ã‚ã¨å±•æœ›**


<!--
ã“ã‚Œã‹ã‚‰é€²ã‚ã¦ã„ãå†…å®¹ã®å…¨ä½“åƒã‚’ã”èª¬æ˜ã—ã¾ã™ã€‚

ã¾ãšã¯ãƒ‡ãƒ¢ã‚’é€šã˜ã¦ã€å®Ÿéš›ã«ä½•ã‚’ä½œã‚‹ã®ã‹ã‚’å…·ä½“çš„ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ã„ãŸã ãã¾ã™ã€‚ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ“ãƒ«ãƒ€ãƒ¼ã®åŸºæœ¬çš„ãªå‹•ä½œã‚„æ©Ÿèƒ½ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

æ¬¡ã«ã€ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®åŸºæœ¬ã¨ãªã‚‹ã€ŒValibot Schema Driven UIã€ã®æ¦‚å¿µã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚TypeScriptã¨ã®è¦ªå’Œæ€§ãŒé«˜ã„Valibotã®ç‰¹å¾´ã‚„ã€ã‚¹ã‚­ãƒ¼ãƒé§†å‹•é–‹ç™ºã®ãƒ¡ãƒªãƒƒãƒˆã«ã¤ã„ã¦ãŠè©±ã—ã—ã¾ã™ã€‚

ç¶šã„ã¦ã€ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦æ˜ã‚Šä¸‹ã’ã¾ã™ã€‚ã©ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹é€ ã‚’è¨­è¨ˆã—ã€å‹å®‰å…¨æ€§ã‚’æ‹…ä¿ã™ã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã€ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å¤‰æ›æ–¹æ³•ã‚„ã€ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£…æ‰‹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ã•ã‚‰ã«ç™ºå±•çš„ãªå†…å®¹ã¨ã—ã¦ã€ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®Ÿè£…ã‚„ç”ŸæˆAIã‚’æ´»ç”¨ã—ãŸText-to-UIæ©Ÿèƒ½ãªã©ã€æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã”ç´¹ä»‹ã—ã¾ã™ã€‚

æœ€å¾Œã«ã€ä»Šå›å­¦ã‚“ã å†…å®¹ã‚’æ—¥å¸¸ã®é–‹ç™ºã«ã©ã†æ´»ã‹ã›ã‚‹ã‹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

åŸºç¤ã‹ã‚‰å¿œç”¨ã¸ã¨é †ã‚’è¿½ã£ã¦é€²ã‚ã¦ã„ãã¾ã™ã®ã§ã€ãœã²æœ€å¾Œã¾ã§ãŠä»˜ãåˆã„ãã ã•ã„ã€‚
-->


---
layout: center
---

# Valibot Schema Driven UI ã®åŸºæœ¬æ¦‚å¿µ

---

# Valibot ã¨ã¯

<v-clicks>

- TypeScript/JavaScriptå‘ã‘ã®ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **å‹å®‰å…¨æ€§ Ã— è»½é‡**
  - ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰TypeScriptå‹ã‚’è‡ªå‹•æ¨è«–
  - ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ãã€æœ€å°700ãƒã‚¤ãƒˆã‹ã‚‰çµ„ã¿è¾¼ã¿å¯èƒ½
- **è±Šå¯Œãªæ©Ÿèƒ½**
  - ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`v.minLength`, `v.email`ãªã©ï¼‰
  - ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®å¤‰æ›é–¢æ•°(`v.transform`, `v.toLowerCase`ãªã©)
  - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³APIã«ã‚ˆã‚‹æŸ”è»Ÿãªåˆæˆ(`v.pipe`)
- **å……å®Ÿã—ãŸã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ **
  - Nest.js, Drizzle ORM, AI SDK, conformãªã©


</v-clicks>

<img src="/valibot-icon.png" class="absolute top-5 right-12 w-50">

<!--
ã¾ãšå‰æçŸ¥è­˜ã¨ã—ã¦ã€Valibotã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚  
Valibotã¯ã€TypeScript/JavaScriptå‘ã‘ã®ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€å‹å®‰å…¨æ€§ã¨è»½é‡ã•ã‚’ä¸¡ç«‹ã•ã›ã¦ã„ã¾ã™ã€‚

ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰TypeScriptã®å‹ã‚’è‡ªå‹•çš„ã«æ¨è«–ã§ãã€å®Ÿè¡Œæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚è¡Œã†ã“ã¨ã§ã€å‹ã¨å®Ÿãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚ã¾ãŸã€ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆã«ã‚ˆã‚Šå¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’ãƒãƒ³ãƒ‰ãƒ«ã§ãã€æœ€å°700ãƒã‚¤ãƒˆã‹ã‚‰çµ„ã¿è¾¼ã¿å¯èƒ½ã§ã™ã€‚

æ©Ÿèƒ½é¢ã§ã¯ã€minLengthã‚„emailãªã©ã®è±Šå¯Œãªãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³APIã«ã‚ˆã£ã¦æŸ”è»Ÿãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæˆãŒå¯èƒ½ã§ã™ã€‚ã•ã‚‰ã«ã€éåŒæœŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„å›½éš›åŒ–ï¼ˆi18nï¼‰ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚‚å……å®Ÿã—ã¦ãŠã‚Šã€Nitro/h3ãƒ«ãƒ¼ãƒˆå‘ã‘ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€Reactãƒ•ã‚©ãƒ¼ãƒ ã¨ã®é€£æºã€ç§»è¡Œæ”¯æ´ãƒ„ãƒ¼ãƒ«ãªã©ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
-->

---

# Valibot ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹


```ts{all|3-7|9-11|12-15|all}
import * as v from "valibot"

// ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
const imageSchema = v.object({
  src: v.string(),
  alt: v.optional(v.string()),
})

// å‹æ¨è«–
type Image = v.InferOutput<typeof imageSchema>
// => { src: string alt?: string }

// å®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const result = v.parse(imageSchema, { src: "https://example.com/image.png" })
// => { src: "https://example.com/image.png", alt: undefined }
```

---

# Server-Driven UI

- ã‚µãƒ¼ãƒãƒ¼å´ãŒã€Œ**ã©ã® UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€ã©ã®ã‚ˆã†ã«é…ç½®ãƒ»è¡¨ç¤ºã™ã‚‹ã‹**ã€ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æŒ‡ç¤ºã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯å—ã‘å–ã£ãŸæŒ‡ç¤ºã«å¾“ã£ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³
- Airbnb ãŒ2021å¹´ã«æå”±ã—ãŸæ¦‚å¿µ [^1] ã§ã€**Ghost**ã¨å‘¼ã°ã‚Œã‚‹è‡ªç¤¾ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç´¹ä»‹ã—ãŸ
- å¾“æ¥ã®Client-Driven UIã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆWebï¼iOSï¼Androidï¼‰ãŒè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã€ã‚µãƒ¼ãƒãƒ¼ã¯ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è¿”ã—ã¦ã„ãŸã€‚ã—ã‹ã—ã“ã®æ–¹å¼ã ã¨ã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–“ã§ UI è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®é‡è¤‡ã‚„ä¹–é›¢ãŒç™ºç”Ÿã—ã‚„ã™ãã€ã‚¢ãƒ—ãƒªã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒé »ç™ºã™ã‚‹å•é¡ŒãŒã‚ã£ãŸ

[^1]:[A Deep Dive into Airbnbâ€™s Server-Driven UI System - The Airbnb Tech Blog](https://medium.com/airbnb-engineering/a-deep-dive-into-airbnbs-server-driven-ui-system-842244c5f5)

<!-- 

å‹•çš„ãªUIãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã—ã¦ã€Server-Driven UIã¨ã„ã†æ¦‚å¿µãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ãŒUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…ç½®ã‚„è¡¨ç¤ºæ–¹æ³•ã‚’æŒ‡ç¤ºã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãã®æŒ‡ç¤ºã«å¾“ã£ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

-->

---
layout: image
image: /sdui.png
backgroundSize: contain
---

---

# ä»Šå›ã®ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã§ã®å‹•çš„UIæ§‹ç¯‰

<v-clicks>

- ä»Šå›ã¯UIã®æ§‹æˆè¦ç´ ã‚’ Block ã¨å‘¼ã³ã€ Block ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒšãƒ¼ã‚¸ã‚’æ§‹æˆã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ãƒ»å‰Šé™¤ãƒ»ç·¨é›†ã§ãã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹
- ãƒ–ãƒ­ãƒƒã‚¯ã¯å„è‡ªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¡ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚‚æŒ‡å®šã§ãã‚‹

â†’ ã“ã‚Œã‚‰ã‚’Valibotã§ã‚¹ã‚­ãƒ¼ãƒåŒ–ã—ã€å‹å®‰å…¨ã«å®Ÿè£…ã™ã‚‹

</v-clicks>

---

# Valibot Schema Driven UI

<img src="/vsdui.png" class="object-contain">

<!-- ã“ã®ã‚¹ã‚­ãƒ¼ãƒã§å®šç¾©ã—ãŸãƒ–ãƒ­ãƒƒã‚¯ã¯ã€å¯¾å¿œã™ã‚‹ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¤‰æ›ã•ã‚Œ UI ã«åæ˜ ã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®ãƒ•ãƒ­ãƒ¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ» UI ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ï¼š

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆUI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰ã‚’è¿½åŠ 
2. Valibot ã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
3. å„ã‚¹ã‚­ãƒ¼ãƒã«å¯¾å¿œã™ã‚‹ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå‹•çš„ã«å‘¼ã³å‡ºã•ã‚Œã€UI ã«è¡¨ç¤º

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã§ UI ã‚’è‡ªç”±ã«æ§‹ç¯‰ã§ãã‚‹ç’°å¢ƒãŒå®Ÿç¾ã—ã¾ã™ã€‚ 
-->

---

# ãƒ‡ãƒ¢

<img src="/1.gif" class="object-contain">


<!--
ä»Šå›å®Ÿè£…ã™ã‚‹ãƒãƒ¼ã‚³ãƒ¼ãƒ‰Webã‚µã‚¤ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼ã®ãƒ‡ãƒ¢ã‚’ãŠè¦‹ã›ã—ã¾ã™ã€‚

å·¦ãƒšã‚¤ãƒ³ã§ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã—ã€çµæœã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å³ãƒšã‚¤ãƒ³ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã¸ã®å°ç·šãŒã‚ã‚Šã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã‚’é–²è¦§ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã¯ã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¹ã‚­ãƒ¼ãƒã§è¡¨ç¾ã—ã€ãã®ã‚¹ã‚­ãƒ¼ãƒã‚’ç·¨é›†ã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã€ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰UIã‚’ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‹ã‚‰ã®ç™ºè¡¨ã§ã¯ã€ã“ã®æ©Ÿèƒ½ã‚’å‹å®‰å…¨ã«å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã€è©³ã—ãèª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãªãŒã‚‰ã€ã‚¹ã‚­ãƒ¼ãƒé§†å‹•UIã®è€ƒãˆæ–¹ã‚’ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ãªãŠã€ã“ã‚Œã‹ã‚‰ç´¹ä»‹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã¯ã€ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã«é–¢ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯é™¤å¤–ã—ã€æœ¬è³ªçš„ãªãƒ­ã‚¸ãƒƒã‚¯ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦èª¬æ˜ã—ã¾ã™ã€‚å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯GitHubã§å…¬é–‹ã—ã¦ã„ã¾ã™ã®ã§ã€ã‚ˆã‚ã—ã‘ã‚Œã°å‚ç…§ã—ã¦ãã ã•ã„ã€‚
-->

---
layout: center
---

# åŸºæœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

---

# å‰æ

- ä»Šå›ã¯Reactã¨Next.jsã‚’ä½¿ç”¨
- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨ä½“ã¯ç´¹ä»‹ã›ãšã€é‡è¦ãªéƒ¨åˆ†ã®ã¿æŠœç²‹ã—ã¦èª¬æ˜ã—ã¾ã™ã€‚ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚‚çœç•¥ã—ã¾ã™
- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰: https://github.com/MH4GF/valibot-schema-driven-ui

---

# Valibotã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

```ts{all|1-2|4-17|19-20|all}
// ãƒ–ãƒ­ãƒƒã‚¯ã®å…±é€šæƒ…å ±ã‚’æŒã¤ã‚¹ã‚­ãƒ¼ãƒã€‚å…¨ã¦ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯IDã‚’æŒã¤
const baseBlockSchema = v.object({ id: v.string() })

// ä»Šå›ã¯ãƒœã‚¿ãƒ³ãƒ»ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ãƒ»ç”»åƒã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’å®šç¾©
// ãã‚Œãã‚Œã®ãƒ–ãƒ­ãƒƒã‚¯ãŒæŒã¤ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©
const buttonSchema = v.intersect([
  baseBlockSchema,
  v.object({ type: v.literal("button"), text: string() }),
])
const paragraphSchema = v.intersect([
  baseBlockSchema,
  v.object({ type: v.literal("paragraph"), text: v.string() }),
])
const imageSchema = v.intersect([
  baseBlockSchema,
  v.object({ type: v.literal("image"), src: v.string(), alt: v.optional(v.string()) }),
])

// å…¨ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã®ãƒ¦ãƒ‹ã‚ªãƒ³å‹
const blockSchema = v.union([buttonSchema, paragraphSchema, imageSchema])
```

---

# Valibotã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ

```ts
// ãƒšãƒ¼ã‚¸ã¯è¤‡æ•°ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’æŒã¤
export const pageSchema = v.object({
  name: v.string(),
  blocks: v.record(v.string(), blockSchema), // IDã«ã‚ˆã‚‹å…¨ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒãƒƒãƒ—
})

// Valibotã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰TypeScriptå‹ã‚’å®šç¾©
export type Page = v.InferOutput<typeof pageSchema>
export type Block = v.InferOutput<typeof blockSchema>
export type Button = v.InferOutput<typeof buttonSchema>
export type Paragraph = v.InferOutput<typeof paragraphSchema>
export type Image = v.InferOutput<typeof imageSchema>
```

---

# Intersectionå‹ã¨Unionå‹

- **Intersectionå‹**: `v.intersect()` / `type A = B & C`
  - è¤‡æ•°ã®ã‚¹ã‚­ãƒ¼ãƒã‚’çµ„ã¿åˆã‚ã›ã¦æ–°ã—ã„ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆ
  - ä¾‹: `baseBlockSchema`ã¨`v.object`ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ãƒœã‚¿ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
  - å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨å›ºæœ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ†é›¢ã—ã¦å®šç¾©
- **Unionå‹**: `v.union()` / `type A = B | C`
  - è¤‡æ•°ã®ã‚¹ã‚­ãƒ¼ãƒã®ã„ãšã‚Œã‹ã«ãƒãƒƒãƒã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
  - ä¾‹: `buttonSchema`ã€`paragraphSchema`ã€`imageSchema`ã‚’çµ„ã¿åˆã‚ã›ã¦ã€å…¨ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
  - ç•°ãªã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã‚’ä¸€ã¤ã®ã‚¹ã‚­ãƒ¼ãƒã§æ‰±ã„ã€çµã‚Šè¾¼ã¿(Type Narrowing)ã‚’è¡Œã†

---
layout: center
---

# å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£…

<img src="/layout-1.png" class="object-contain">

---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£…

<img src="/layout-2.png" class="object-contain">

---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£… - Editorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

<img src="/layout-2.png" class="object-contain absolute top-6 right-6 w-50 z-10">

```tsx{all|2-3|5-11|13-22|all}
const Editor: FC = () => {
  // ãƒšãƒ¼ã‚¸ã®çŠ¶æ…‹ç®¡ç†
  const [page, setPage] = useState<Page>({ name: "My Page", blocks: {} })
  const [selectedBlockId, setSelectedBlockId] = useState<string | null>(null)
  // ãƒ–ãƒ­ãƒƒã‚¯ã®è¿½åŠ ã¨ç·¨é›†
  const addBlock = (block: Block) => {
    setPage((prev) => ({ ...prev, blocks: { ...prev.blocks, [block.id]: block } }))
  }
  const updateBlock = (block: Block) => {
    setPage((prev) => ({ ...prev, blocks: { ...prev.blocks, [block.id]: block } }))
  }

  return (
    <div>
      <div>
        <AddBlockPanel addBlock={addBlock} />
        <BlockTree page={page} selectedBlockId={selectedBlockId} setSelectedBlockId={setSelectedBlockId} />
      </div>
      <PageRenderer page={page} />
      <BlockFormPanel block={page.blocks[selectedBlockId]} updateBlock={updateBlock} />
    </div>
  )
}
```

---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£… - ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

<img src="/layout-2.png" class="object-contain absolute top-6 right-6 w-50 z-10">

- ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
- ä»Šå›ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ã‹ãªã‚Šãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```tsx
const ButtonBlock: FC<{ block: Button }> = ({ block }) => (
  <button type="button">{block.text}</button>
)
const ParagraphBlock: FC<{ block: Paragraph }> = ({ block }) => (
  <p>{block.text}</p>
)
const ImageBlock: FC<{ block: Image }> = ({ block }) => (
  <img src={block.src} alt={block.alt || ""} />
)
```

---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£… - PageRenderer

<img src="/layout-2.png" class="object-contain absolute top-6 right-6 w-50 z-10">

- ãƒ–ãƒ­ãƒƒã‚¯ã®typeã§çµã‚Šè¾¼ã¿ã€å„ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™

```tsx
const BlockRenderer: FC<{ block: Block }> = ({ block }) => {
  switch (block.type) {
    case "button":
      return <ButtonBlock key={block.id} block={block} />
    case "paragraph":
      return <ParagraphBlock key={block.id} block={block} />
    case "image":
      return <ImageBlock key={block.id} block={block} />
  }
}

const PageRenderer: FC<{ page: Page }> = ({ page }) => {
  return (
    <div>
      <h1>{page.name}</h1>
      {Object.values(page.blocks).map((block) => (
        <BlockRenderer key={block.id} block={block} />
      ))}
    </div>
  )
}
```

<!-- ã‹ãªã‚Šãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªUIã‚’å®šç¾©ã—ãŸ 
switchã§åˆ†å²ã—ã€å‹ã®çµã‚Šè¾¼ã¿ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šå„ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ç‰¹å®šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
-->



---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£… - AddBlockPanel

<img src="/layout-2.png" class="object-contain absolute top-6 right-6 w-50 z-10">

- ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ã§ãã‚‹

```tsx
const AddBlockPanel: FC<{ addBlock: (block: Block) => void }> = ({ addBlock }) => {
  const addButton = () => {
    addBlock({ id: crypto.randomUUID(), type: "button", text: "Click me" })
  }
  const addParagraph = () => {...} // çœç•¥
  const addImage = () => {...} // çœç•¥

  return (
    <aside>
      <button onClick={() => addButton()}>Add Button</button>
      <button onClick={() => addParagraph()}>Add Paragraph</button>
      <button onClick={() => addImage()}>Add Image</button>
    </aside>
  )
}
```

---

# ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£… - BlockFormPanel

<img src="/layout-2.png" class="object-contain absolute top-6 right-6 w-50 z-10">

- ãƒ–ãƒ­ãƒƒã‚¯ã®typeã«å¿œã˜ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å†…å®¹ã‚’å¤‰ãˆã‚‹

```tsx{all|3-4|all}
const BlockFormPanel: FC<{ block: Block, updateBlock: (block: Block) => void }> = ({ block, updateBlock }) => {
  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target
    const newBlock = v.parse(blockSchema, { ...block, [name]: value })
    updateBlock(newBlock)
  }

  return (
    <div>
      {block.type === "button" && (
        <div>
          <label htmlFor="text">Button text</label>
          <input type="text" name="text" value={block.text} onChange={handleChange} />
        </div>
      )}
      {block.type === "paragraph" && (...çœç•¥...)}
      {block.type === "image" && (...çœç•¥...)}
    </div>
  )
}
```

---

# ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–

- ä»Šå›ã¯ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’URLã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä¿å­˜

```tsx{2-13}
const Editor: FC = () => {
  // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
  const [page, setPage] = useState<Page>(() => {
    const savedData = searchParams.data
    if (savedData) return parse(pageSchema, JSON.parse(decodeURIComponent(savedData)))
      
    return { name: "New Page", blocks: {} }
  })
  // ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä¿å­˜
  useEffect(() => {
    const queryData = encodeURIComponent(JSON.stringify(page))
    window.history.pushState({}, "", `?data=${queryData}`);
  }, [page])

  const [selectedBlockId, setSelectedBlockId] = useState<string | null>(null)
  const addBlock = (block: Block) => {
    setPage((prev) => ({ ...prev, blocks: { ...prev.blocks, [block.id]: block } }))
  }
  const updateBlock = (block: Block) => {
    setPage((prev) => ({ ...prev, blocks: { ...prev.blocks, [block.id]: block } }))
  }

  return (
    <div>
      <AddBlockPanel addBlock={addBlock} />
      <PageRenderer page={page} />
      <BlockFormPanel block={page.blocks[selectedBlockId]} updateBlock={updateBlock} />
    </div>
  )
}
```

<!-- ä»Šå›ã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä¿å­˜ -->

---
layout: center
---

# æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³

---

# æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³

- è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾
- ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- JavaScriptã®å®Ÿè¡Œãƒ»ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰æ©Ÿèƒ½ã®è¿½åŠ 
- ç”ŸæˆAIã‚’åˆ©ç”¨ã—ãŸText-to-UI

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾

- ç¾åœ¨ã®blocksã¯ãƒ•ãƒ©ãƒƒãƒˆãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã€ãƒ–ãƒ­ãƒƒã‚¯é–“ã®éšå±¤æ§‹é€ ãŒè¡¨ç¾ã§ããªã„
- `<div><p>Paragraph</p></div>` ã®ã‚ˆã†ãªãƒã‚¹ãƒˆã‚’ã©ã®ã‚ˆã†ã«è¡¨ç¾ã™ã‚‹ã‹ï¼Ÿ

<img src="/nesting.png" />

---

# å‚è€ƒ: React(JSX)ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

- JSX ã‚’ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã—å®Ÿè¡Œã™ã‚‹ã¨ã€æˆ»ã‚Šå€¤ã¨ã—ã¦å³ã®ã‚ˆã†ãªãƒ—ãƒ¬ãƒ¼ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¿”ã‚‹
- childrenã¯ `ReactNode` å‹ãŒå…¥ã‚Šã€0 å€‹ãªã‚‰undefinedã€1 å€‹ãªã‚‰å˜ä½“ã€è¤‡æ•°ãªã‚‰é…åˆ—

<div class="grid grid-cols-2 gap-4">

```tsx
function Greeting({ name }) {
  return (
    <div className="card">
      <h1>Hello, {name}</h1>
    </div>
  )
}

const result = Greeting("World")
console.dir(result, { depth: null })
```

```ts
{
  '$$typeof': Symbol(react.transitional.element),
  type: 'div',
  key: null,
  props: {
    className: 'card',
    children: {
      '$$typeof': Symbol(react.transitional.element),
      type: 'h1',
      key: null,
      props: { children: [ 'Hello, ', 'World' ] },
      _owner: null,
      _store: {}
    }
  },
  _owner: null,
  _store: {}
}
```

</div>

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾

- blockã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ `children: Block[]` ã‚’è¿½åŠ ã™ã‚‹ã¨è‰¯ã„ï¼Ÿ

```tsx
const divSchema = v.object({
  type: v.literal("div"),
  children: v.array(blockSchema),
})
```

- ğŸ™†â€â™‚ï¸ Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹éš›ã®æ§‹é€ ã«æ²¿ã†
- ğŸ™…â€â™‚ï¸ ãƒ–ãƒ­ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢ã«å†å¸°å‡¦ç†ãŒå¿…è¦ã«ãªã‚Šã€æ›´æ–°ãƒ»è¿½åŠ ãƒ»å‰Šé™¤ãŒç…©é›‘ã«ãªã‚‹
- ğŸ™…â€â™‚ï¸ å°†æ¥çš„ã«ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹éš›ã«ã€æ§‹é€ ã‚’ä¿ã¡ãªãŒã‚‰ä½ç½®ã‚’æ›´æ–°ã™ã‚‹éš›ã®å¤‰æ›´é‡ãŒå¤šããªã‚‹

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾

- baseBlockSchema ã« `parentId` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã€ãƒ–ãƒ­ãƒƒã‚¯ãŒè¦ªãƒ–ãƒ­ãƒƒã‚¯ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ã€ã©ã®ãƒ–ãƒ­ãƒƒã‚¯ã«æ‰€å±ã™ã‚‹ã‹ã‚’æ˜ç¤ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ 

```ts{all|3|6-10}
const baseBlockSchema = v.object({
  id: v.string(),
  parentId: v.optional(v.string()),
})

// divãƒ–ãƒ­ãƒƒã‚¯ã‚‚ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¿½åŠ 
const divBlockSchema = v.intersect([
  baseBlockSchema,
  v.object({ type: v.literal("div") }),
])
```

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾

- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®å‰ã«ã ã‘ãƒ–ãƒ­ãƒƒã‚¯ã‚’Reactã®éšå±¤æ§‹é€ ã«å¤‰æ›ã™ã‚‹

```tsx
type BlockWithChildren = Block & { children: BlockWithChildren[] }

const buildHierarchy = (blocks: Block[]): BlockWithChildren[] => {
  const map = new Map<string, BlockWithChildren>()

  // å„ãƒ–ãƒ­ãƒƒã‚¯ã‚’childrenãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä»˜ãã§åˆæœŸåŒ–
  blocks.forEach((block) => {
    map.set(block.id, { ...block, children: [] })
  })

  const result: BlockWithChildren[] = []

  // è¦ªå­æ§‹é€ ã‚’æ§‹ç¯‰
  blocks.forEach((block) => {
    const parentId = block.parentId
    if (parentId && map.has(parentId)) {
      map.get(parentId)!.children.push(map.get(block.id)!)
    } else {
      result.push(map.get(block.id)!)
    }
  })

  return result
}
```

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾


```tsx{all|1-4|12-16}
const DivBlock: FC<{ block: DivBlock, children?: ReactNode }> = ({ block, children }) => (
  <div>{children}</div>
)

export const BlockRenderer: FC<Props> = ({ block }) => {
  switch (block.type) {
    
    // ~~ ä»–ã®ãƒ–ãƒ­ãƒƒã‚¯ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç† ~~

    case "div":
      return (
        <DivBlock key={block.id} block={block}>
          {block.children.map((child) => (
            <BlockRenderer key={child.id} block={child} />
          ))}
        </DivBlock>
      )
  }
}
```

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾

- ãƒ–ãƒ­ãƒƒã‚¯ã®è¿½åŠ æ™‚ã«ã€é¸æŠä¸­ã®ãƒ–ãƒ­ãƒƒã‚¯ã«æ‰€å±ã•ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹

```tsx
const addBlock = (block: Block) => {
  const parentIdObj = selectedBlockId ? { parentId: selectedBlockId } : {} // é¸æŠä¸­ã ã£ãŸã‚‰è¨­å®š
  setPage((prev) => ({ ...prev, blocks: { ...prev.blocks, [block.id]: { ...block, ...parentIdObj } } }))
}
```

- ãƒ•ãƒ©ãƒƒãƒˆãªæ§‹é€ ã®ã¾ã¾ãªã®ã§ã€æ›´æ–°å‡¦ç†ã¯å¤‰æ›´ãŒä¸è¦

---

# è¦ªå­é–¢ä¿‚ãƒ»UIã®ãƒã‚¹ãƒˆã®è¡¨ç¾

- ğŸ™†â€â™‚ï¸ `page.blocks[blockId]` ã§ãƒ–ãƒ­ãƒƒã‚¯ã®æ¤œç´¢ãŒå¯èƒ½ã«ãªã‚Šã€ãƒ•ãƒ©ãƒƒãƒˆãªæ§‹é€ ã®ã¾ã¾ã®ãŸã‚æ›´æ–°ãƒ»è¿½åŠ ãƒ»å‰Šé™¤ãŒå®¹æ˜“
- ğŸ™†â€â™‚ï¸ ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã¨ã—ã¦ã‚‚ã€è¦ªãƒ–ãƒ­ãƒƒã‚¯ã® `order` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã§è‰¯ã„

---
layout: center
---

# ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®Ÿè£…

---

# ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®Ÿè£…

- ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒ¼ãƒã§å®šç¾©ã—ã€ãã‚Œã‚’ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¹ã‚­ãƒ¼ãƒã«è¿½åŠ ã™ã‚‹

```ts{all|1-5|12}
const stylesSchema = v.object({
  color: v.optional(v.string()),
  backgroundColor: v.optional(v.string()),
  fontSize: v.optional(v.string()),
})

// ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¹ã‚­ãƒ¼ãƒã« styles ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
const baseBlockSchema = v.object({
  id: v.string(),
  parentId: v.optional(v.string()),
  name: v.string(),
  styles: stylesSchema, // ã‚¹ã‚¿ã‚¤ãƒ«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¿½åŠ 
})
```

---

# ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®Ÿè£…

- å„ãƒ–ãƒ­ãƒƒã‚¯ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ã™ã‚‹

```tsx{all|2}
const ButtonBlock: FC<BlockProps<Button>> = ({ block }) => (
  <button type="button" style={block.styles}>
    {block.text}
  </button>
)
```

---

# ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã®å®Ÿè£…

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®šã§ãã‚‹æŸ”è»Ÿãªä»•çµ„ã¿ã‚’æä¾›ã§ãã‚‹
- ãŸã ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢ï¼ˆXSSãªã©ï¼‰ã«ã¯æ³¨æ„ãŒå¿…è¦
- å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ã‚¹ã‚¿ã‚¤ãƒ«å€¤ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒ»æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒé‡è¦
  - color ã‚„ backgroundColor ã«ç„¡åŠ¹ãªå€¤ã‚„å±é™ºãªã‚³ãƒ¼ãƒ‰ãŒå…¥ã£ã¦ã„ãªã„ã‹æ¤œè¨¼
  - HTML/CSSã®ä»•æ§˜ã«æ²¿ã£ãŸå®‰å…¨ãªå€¤ã®ã¿è¨±å¯

<!-- ã“ã®å®Ÿè£…ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®šã§ãã‚‹æŸ”è»Ÿãªä»•çµ„ã¿ã‚’æä¾›ã—ã¾ã™ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢ã«é–¢ã—ã¦ã¯è€ƒæ…®ãŒä¸è¶³ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã«å°å…¥ã™ã‚‹å ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã‚¹ã‚¿ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦é©åˆ‡ãªã‚µãƒ‹ã‚¿ã‚¤ã‚ºå‡¦ç†ã‚’æ–½ã—ã€ä¸æ­£ãªå…¥åŠ›ã‚„æ½œåœ¨çš„ãª XSS æ”»æ’ƒã‚’é˜²ãå¯¾ç­–ãŒå¿…è¦ã§ã™ã€‚

ãŸã¨ãˆã°ã€color ã‚„ backgroundColor ã«ç„¡åŠ¹ãªå€¤ã‚„å±é™ºãªã‚³ãƒ¼ãƒ‰ãŒå…¥ã£ã¦ã„ãªã„ã‹ã‚’æ¤œè¨¼ã—ã€å±é™ºãªæ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã¾ãŸã€HTML ã‚„ CSS ã®ä»•æ§˜ã«æ²¿ã£ãŸå®‰å…¨ãªå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ -->


---
layout: center
---

# JavaScriptã®å®Ÿè¡Œ(ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰æ©Ÿèƒ½ã®è¿½åŠ )

---

# JavaScriptã®å®Ÿè¡Œ(ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰æ©Ÿèƒ½ã®è¿½åŠ )

- ãƒœã‚¿ãƒ³ã® onClick ã‚¤ãƒ™ãƒ³ãƒˆã«ä»»æ„ã® JavaScript ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ JavaScript ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã«å®Ÿè¡Œ
- ç›´æ¥çš„ãª JavaScript å®Ÿè¡Œã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ãŸã‚ã€ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ä»Šå›ã¯ iframe ã® sandbox å±æ€§ã‚’æ´»ç”¨ã—ã€å¤–éƒ¨ã¨ã®ã‚„ã‚Šã¨ã‚Šã‚’åˆ¶é™ã—ã¦ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹

<!-- ã“ã®æ©Ÿèƒ½ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç°¡å˜ã«ãƒœã‚¿ãƒ³ã® onClick ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ä»»æ„ã® JavaScript ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã€ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«ãã®ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ä»•çµ„ã¿ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

é‡è¦ãªç‚¹ã¯ã€ç›´æ¥çš„ãª JavaScript ã®å®Ÿè¡Œã«ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒä¼´ã†ãŸã‚ã€ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã§ã™ã€‚ä»Šå›ã¯ iframe ã‚’ä½¿ç”¨ã—ã€JavaScript ã‚³ãƒ¼ãƒ‰ã‚’å®‰å…¨ã«åˆ†é›¢ã•ã‚ŒãŸç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’æ¡ç”¨ã—ã¾ã™ã€‚ iframe è¦ç´ ã® sandbox å±æ€§ã‚’æ´»ç”¨ã—ã¦å¤–éƒ¨ã¨ã®ã‚„ã‚Šã¨ã‚Šã‚’åˆ¶é™ã—ã€ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆã¾ã™ã€‚ -->

---

# JavaScriptã®å®Ÿè¡Œ(ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰æ©Ÿèƒ½ã®è¿½åŠ )

```ts{all|6}
const buttonSchema = v.intersect([
  baseBlockSchema,
  v.object({
    type: v.literal("button"),
    text: v.string(),
    onClick: v.string(), // ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ JavaScript ã‚³ãƒ¼ãƒ‰
  }),
])
```

---
layout: two-cols-header
---

# iframe ã«ã‚ˆã‚‹ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸ JavaScript å®Ÿè¡Œ

<style>
  .two-cols-header {
    gap: 1rem;
  }

  code {
    font-size: 10px!important;
  }
</style>

::left::
```tsx{all|4-13|15-21|all}
export const ButtonBlock: FC<{ block: Button }> = ({ block }) => {
  const iframeRef = useRef<HTMLIFrameElement>(null)

  useEffect(() => {
    const iframeWindow = iframeRef.current?.contentWindow

    if (iframeWindow) {
      iframeWindow.postMessage(
        { type: "LOAD_SCRIPT", script: block.onClick },
        "*"
      )
    }
  }, [iframeRef.current, block.onClick])

  const handleClick = useCallback(() => {
    const iframeWindow = iframeRef.current?.contentWindow
    if (iframeWindow) {
      iframeWindow.postMessage({ type: "EXECUTE_SCRIPT" }, "*")
    }
  }, [])
```

::right::

```tsx{all|9-10|all}
  const srcDoc = `
    <script>
      let script = ''
      window.addEventListener('message', (event) => {
        if (event.data.type === 'LOAD_SCRIPT') {
          script = event.data.script
        } else if (event.data.type === 'EXECUTE_SCRIPT') {
          try {
            const func = new Function(script)
            func()
          } catch (error) {
            console.error('Script execution error:', error)
          }
        }
      })
    </script>
  `
  return (
    ...ButtonBlockã®æ—¢å­˜å®Ÿè£…ã€çœç•¥...
    <iframe ref={iframeRef} sandbox="allow-scripts allow-modals" srcDoc={srcDoc} />
  )
}
```

---

# iframe ã«ã‚ˆã‚‹ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸ JavaScript å®Ÿè¡Œ

- allow-scripts: JavaScript ã®ã¿ã‚’è¨±å¯ã—ã€ä»–ã®å±é™ºãªæ“ä½œï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ç”Ÿæˆãªã©ï¼‰ã¯ä¸€åˆ‡ç¦æ­¢
- allow-modals: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ç”Ÿæˆã‚’è¨±å¯ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…·ä½“çš„ã«ã¯ `alert('hello')` ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œå¯èƒ½
- å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ JavaScript ã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå‡¦ç†ã‚„ã€CSPã®è¨­å®šã‚‚å¿…è¦

---
layout: center
---

# ç”ŸæˆAIã‚’åˆ©ç”¨ã—ãŸText-to-UIæ©Ÿèƒ½

---

# ç”ŸæˆAIã‚’åˆ©ç”¨ã—ãŸText-to-UIæ©Ÿèƒ½

- OpenAIãªã©ã®AIãƒ¢ãƒ‡ãƒ«ã§ã¯ã€JSON Schemaã«æº–æ‹ ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆã§ãã‚‹Structured Outputã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚‹
- Valibotã¯ã‚¹ã‚­ãƒ¼ãƒã‚’JSON Schemaã«å¤‰æ›ã§ãã‚‹ãŸã‚ã€AIã«Valibotã‚¹ã‚­ãƒ¼ãƒã«æº–æ‹ ã—ãŸãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã•ã›ã‚‹
- ä»Šå›ã¯Vercel AI SDK, OpenAI APIã‚’åˆ©ç”¨

---

# ç”ŸæˆAIã‚’åˆ©ç”¨ã—ãŸText-to-UIæ©Ÿèƒ½

```ts{all|13|14|all}
import { openai } from "@ai-sdk/openai"
import { streamObject } from "ai"
import { pageSchema } from "../../schema"
import { valibotSchema } from "@ai-sdk/valibot"

export const maxDuration = 30

export async function POST(req: Request) {
  const { prompt } = await req.json()

  const result = streamObject({
    model: openai("gpt-4o"),
    schema: valibotSchema(pageSchema),
    system: "You are a UI block generator. Create a complete page layout based on the user's request.",
    prompt,
  })

  return result.toTextStreamResponse()
}
```

---

# ç”ŸæˆAIã‚’åˆ©ç”¨ã—ãŸText-to-UIæ©Ÿèƒ½

```tsx{all|2-5|6-13|all}
export const ChatPopup: FC<{ setPage: (page: Page) => void }> = ({ setPage }) => {
  const { object, error, submit, isLoading } = useObject({
    api: "/api/chat",
    schema: valibotSchema(pageSchema),
  })

  useEffect(() => {
    const result = v.safeParse(pageSchema, object)

    if (result.success) {
      setPage(result.output)
    }
  }, [object, setPage])

  const onSubmit = (e: FormEvent<HTMLFormElement>) => submit({ prompt: e.target.value })

  return (
    <form onSubmit={onSubmit}>
      <input disabled={isLoading} />
      <button type="submit" disabled={isLoading}>Submit</button>
    </form>
  )
}
```

---
layout: center
---

# ã¾ã¨ã‚ã¨å±•æœ›

---

# æœ¬ç™ºè¡¨ã®ã¾ã¨ã‚

- **Valibot Schema Driven UI ã¨ã¯**ï¼šUI ãƒ–ãƒ­ãƒƒã‚¯ã‚’ Valibot ã‚¹ã‚­ãƒ¼ãƒã§å‹å®‰å…¨ã«å®šç¾©ã—ã€ãã®ã¾ã¾ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨å‹æ¨è«–ã‚’ä¸¡ç«‹ã•ã›ã‚‹è¨­è¨ˆæ‰‹æ³•
- **åŸºç¤**ï¼šãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ› â†’ ã‚¹ã‚­ãƒ¼ãƒå¤‰æ› â†’ React ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹æµã‚Œã‚’è§£èª¬ã—ã€ç·¨é›†ã‚’å³æ™‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã‚’å®Ÿè£…
- **ç™ºå±•**ï¼š`parentId` ã«ã‚ˆã‚‹è¦ªå­æ§‹é€ ã®å®šç¾©ã€ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ãƒ»ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰æ©Ÿèƒ½ãƒ»ç”Ÿæˆ AI ã‚’ä½¿ã£ãŸ Text-to-UI ã¨ã„ã£ãŸæ‹¡å¼µä¾‹ã‚’ç´¹ä»‹

---

# ãã®ä»–ã®æ‹¡å¼µ

- ã‚ˆã‚Šå¤šãã®ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚µãƒãƒ¼ãƒˆ
- è¤‡æ•°ãƒšãƒ¼ã‚¸ã®ã‚µãƒãƒ¼ãƒˆã‚„ã€ã‚¢ãƒ³ã‚«ãƒ¼ãƒªãƒ³ã‚¯ã®ã‚µãƒãƒ¼ãƒˆ
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API ã¨ã®ãƒ‡ãƒ¼ã‚¿é€£æº
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã®ãƒ–ãƒ­ãƒƒã‚¯ã®é †åºå¤‰æ›´ã‚„ã€ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã§ã®ã‚µã‚¤ã‚ºå¤‰æ›´ãªã©ã®ã‚¨ãƒ‡ã‚£ã‚¿ã®æ”¹å–„
- Figma ã‚„ Notion ã®ã‚ˆã†ãªã€è¤‡æ•°äººã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«å…±åŒç·¨é›†ã§ãã‚‹æ©Ÿèƒ½ã®ã‚µãƒãƒ¼ãƒˆ

---
layout: center
---

# Thank you for listening!

Slides on [mh4gf.dev](https://talks.mh4gf.dev/20250524)
